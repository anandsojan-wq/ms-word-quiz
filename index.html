<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MS Word Quiz</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --bg-dark: #050505;
            --primary: #00f2ea;
            --secondary: #ff0050;
            --accent: #7d2ae8;
            --glass: rgba(20, 20, 30, 0.7);
            --glass-border: rgba(255, 255, 255, 0.1);
            --text: #ffffff;
            --text-muted: #8b9bb4;
        }

        body {
            margin: 0;
            font-family: 'Outfit', sans-serif;
            background-color: var(--bg-dark);
            /* Animated Mesh Gradient Background */
            background-image: 
                radial-gradient(at 0% 0%, rgba(125, 42, 232, 0.3) 0px, transparent 50%),
                radial-gradient(at 100% 0%, rgba(0, 242, 234, 0.3) 0px, transparent 50%),
                radial-gradient(at 100% 100%, rgba(255, 0, 80, 0.3) 0px, transparent 50%);
            background-size: 150% 150%;
            animation: gradientMove 15s ease infinite;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: var(--text);
            overflow-x: hidden;
        }

        @keyframes gradientMove {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* --- CONTAINER --- */
        .app-container {
            width: 100%; max-width: 550px;
            background: var(--glass);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border: 1px solid var(--glass-border);
            border-radius: 30px;
            padding: 40px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            text-align: center;
            position: relative;
            overflow: hidden;
            transition: height 0.3s ease;
        }

        /* Logo Glow */
        .login-logo {
            width: 140px;
            margin-bottom: 20px;
            filter: drop-shadow(0 0 15px rgba(0, 242, 234, 0.4));
            transition: transform 0.5s;
        }
        .login-logo:hover { transform: scale(1.05) rotate(2deg); }

        h1 {
            font-weight: 800; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px;
            background: linear-gradient(to right, #fff, #a5a5a5);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        p { color: var(--text-muted); font-size: 14px; margin-bottom: 30px; font-weight: 500; }

        /* --- INPUTS --- */
        input {
            width: 100%; padding: 16px; margin-bottom: 15px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid var(--glass-border);
            border-radius: 16px;
            color: white; font-family: inherit; font-weight: 600;
            box-sizing: border-box; outline: none;
            transition: 0.3s;
        }
        input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 20px rgba(0, 242, 234, 0.2);
            background: rgba(0, 0, 0, 0.5);
        }

        /* --- NEON BUTTONS --- */
        .btn {
            width: 100%; padding: 18px;
            background: linear-gradient(90deg, var(--accent), var(--secondary));
            border: none; border-radius: 16px;
            color: white; font-weight: 800; font-size: 16px;
            text-transform: uppercase; letter-spacing: 1px;
            cursor: pointer; position: relative; overflow: hidden;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            box-shadow: 0 10px 30px rgba(125, 42, 232, 0.3);
        }
        .btn:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 15px 40px rgba(125, 42, 232, 0.5);
        }
        .btn:active { transform: scale(0.98); }
        .btn:disabled { filter: grayscale(1); opacity: 0.6; cursor: not-allowed; transform: none; }

        /* --- PROGRESS BAR --- */
        .progress-track {
            width: 100%; height: 6px; background: rgba(255,255,255,0.1);
            border-radius: 10px; margin-bottom: 25px; overflow: hidden;
        }
        .progress-fill {
            height: 100%; width: 0%; background: var(--primary);
            border-radius: 10px; transition: width 0.5s ease;
            box-shadow: 0 0 10px var(--primary);
        }

        /* --- TOPIC CARDS --- */
        .chapter-grid {
            display: grid; grid-template-columns: 1fr; gap: 12px;
            max-height: 350px; overflow-y: auto; padding: 5px;
        }
        /* Custom Scrollbar */
        .chapter-grid::-webkit-scrollbar { width: 6px; }
        .chapter-grid::-webkit-scrollbar-thumb { background: var(--glass-border); border-radius: 10px; }

        @media(min-width: 500px) { .chapter-grid { grid-template-columns: 1fr 1fr; } }

        .chapter-btn {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--glass-border);
            padding: 15px; border-radius: 16px;
            font-size: 13px; font-weight: 700; text-align: left;
            cursor: pointer; transition: all 0.3s;
            display: flex; align-items: center; justify-content: space-between;
        }
        .chapter-btn:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: var(--primary);
            transform: translateX(5px);
        }
        .chapter-btn.selected {
            background: linear-gradient(45deg, var(--primary), #00a8a3);
            border-color: transparent;
            color: #000;
            box-shadow: 0 5px 20px rgba(0, 242, 234, 0.3);
        }

        /* --- QUIZ OPTIONS --- */
        .option-btn {
            width: 100%; padding: 16px; margin-bottom: 12px;
            background: rgba(255,255,255,0.03);
            border: 1px solid var(--glass-border);
            border-radius: 16px; color: var(--text);
            text-align: left; font-weight: 600; cursor: pointer;
            transition: all 0.2s; font-size: 15px;
        }
        .option-btn:hover {
            background: rgba(255,255,255,0.1);
            border-color: var(--primary);
        }
        .correct {
            background: rgba(46, 213, 115, 0.2) !important;
            border-color: #2ed573 !important; color: #2ed573;
        }
        .wrong {
            background: rgba(255, 71, 87, 0.2) !important;
            border-color: #ff4757 !important; color: #ff4757;
        }

        /* --- LOADER --- */
        .loader {
            width: 50px; height: 50px;
            border: 4px solid rgba(255,255,255,0.1);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="app-container">
        
        <div id="screen-login">
            <img src="logo.png" alt="Logo" class="login-logo">
            <h1>Word Quiz Portal</h1>
            <p>Access the portal to begin your assessment.</p>
            
            <input type="text" id="inp-name" placeholder="Full Name">
            <input type="tel" id="inp-phone" placeholder="Phone Number" maxlength="10">
            <button class="btn" onclick="goToChapters()">Enter Portal ‚ûù</button>
        </div>

        <div id="screen-chapters" class="hidden">
            <h1>Select Module</h1>
            <p>Choose a topic to generate an AI quiz.</p>
            <div class="chapter-grid" id="chapter-list"></div>
            <button class="btn" id="start-quiz-btn" style="margin-top:20px;" onclick="startQuiz()" disabled>Generate Quiz ‚ö°</button>
        </div>

        <div id="screen-loading" class="hidden">
            <h1 class="pulse">Processing...</h1>
            <div class="loader"></div>
            <p>AI is generating 20 questions on<br><b style="color:var(--primary)" id="loading-topic">...</b></p>
        </div>

        <div id="screen-quiz" class="hidden">
            <div class="progress-track"><div class="progress-fill" id="progress-bar"></div></div>

            <div style="display:flex; justify-content:space-between; font-size:14px; color:var(--text-muted); margin-bottom:15px; font-weight:700;">
                <span id="q-progress">Q 1</span>
                <span>Score: <span style="color:var(--primary)" id="live-score">0</span></span>
            </div>

            <h2 id="q-text" style="font-size:20px; font-weight:700; margin-bottom:25px; min-height:60px;">Loading Question...</h2>
            
            <div id="options-container"></div>
            
            <button id="next-btn" class="btn hidden" style="margin-top:20px; background: var(--primary);" onclick="nextQuestion()">Next Question ‚ûù</button>
        </div>

        <div id="screen-result" class="hidden">
            <h1>Assessment Complete</h1>
            <div style="font-size:80px; margin:20px 0; text-shadow: 0 0 30px var(--primary);">üèÜ</div>
            <p>Score successfully uploaded to database.</p>
            
            <div style="background:rgba(255,255,255,0.05); padding:20px; border-radius:20px; margin-bottom:20px; border:1px solid var(--glass-border);">
                <span style="font-size:14px; color:var(--text-muted); text-transform:uppercase; letter-spacing:1px;">Final Score</span>
                <h2 style="font-size:56px; color:var(--primary); margin:0; line-height:1;"><span id="final-score">0</span><span style="font-size:20px; color:var(--text-muted)">/20</span></h2>
            </div>

            <button class="btn" onclick="location.reload()">Return to Home</button>
        </div>

    </div>

<script>
    // ---------------- CONFIGURATION ---------------- //
    
    // ‚úÖ YOUR GOOGLE SCRIPT URL
    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyGk79tReDKSBGzXK572mQhKhkS84rL0HGj6ioBk_m6mb8G7vfS1Lc_OGPVgckQ-q-eyg/exec"; 

    // ‚úÖ YOUR API KEY
    const API_KEY = "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"; 

    // TOPICS
    const chapters = [
        "1. Introduction to Word Processing",
        "2. MS Word Interface",
        "3. File Menu Operations",
        "4. Edit Menu Operations",
        "5. Viewing Documents",
        "6. Insert Menu Features",
        "7. Formatting Features",
        "8. Tools Menu",
        "9. Tables in MS Word",
        "10. Keyboard Shortcuts",
        "11. Help Menu"
    ];

    // ---------------- VARIABLES ---------------- //
    let userDetails = { name: "", phone: "", chapter: "" };
    let questions = [];
    let currentQIndex = 0;
    let score = 0;

    // ---------------- LOGIC ---------------- //

    // 1. LOGIN
    function goToChapters() {
        const name = document.getElementById('inp-name').value;
        const phone = document.getElementById('inp-phone').value;

        if(!name || phone.length < 10) return alert("Please enter valid Name and Phone!");
        
        userDetails.name = name;
        userDetails.phone = phone;

        const grid = document.getElementById('chapter-list');
        grid.innerHTML = "";
        chapters.forEach(chap => {
            const btn = document.createElement('div');
            btn.className = 'chapter-btn';
            btn.innerHTML = `${chap} <span>‚ûú</span>`;
            btn.onclick = () => selectChapter(btn, chap);
            grid.appendChild(btn);
        });

        switchScreen('screen-chapters');
    }

    function selectChapter(btn, chapName) {
        document.querySelectorAll('.chapter-btn').forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
        userDetails.chapter = chapName;
        document.getElementById('start-quiz-btn').disabled = false;
    }

    // 2. GENERATE QUIZ
    async function startQuiz() {
        switchScreen('screen-loading');
        document.getElementById('loading-topic').innerText = userDetails.chapter;

        const systemPrompt = `You are an IT Teacher specializing in Microsoft Word. 
        Create exactly 20 Multiple Choice Questions (MCQs) on the topic: "${userDetails.chapter}".
        
        Format: JSON Array of objects. 
        Each object: { "q": "Question text", "options": ["A", "B", "C", "D"], "correct": "Correct Option Text" }
        
        IMPORTANT:
        - Questions must be specific to MS Word (2016/2019 versions).
        - If topic is 'Keyboard Shortcuts', focus on Ctrl+ keys.
        - JSON ONLY. No markdown.`;

        try {
            const response = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                method: "POST",
                headers: { "Authorization": `Bearer ${API_KEY}`, "Content-Type": "application/json" },
                body: JSON.stringify({
                    model: "llama-3.3-70b-versatile",
                    messages: [{ role: "user", content: systemPrompt }],
                    temperature: 0.5
                })
            });

            const data = await response.json();
            let rawContent = data.choices[0].message.content;
            rawContent = rawContent.replace(/```json/g, "").replace(/```/g, "").trim();
            questions = JSON.parse(rawContent);
            
            if(questions.length > 0) {
                currentQIndex = 0; score = 0;
                loadQuestion();
                switchScreen('screen-quiz');
            } else { throw new Error("Empty list"); }

        } catch (error) {
            console.error(error);
            alert("AI Error. Please check API Key.");
            location.reload();
        }
    }

    // 3. RUN QUIZ
    function loadQuestion() {
        const q = questions[currentQIndex];
        
        // Update Progress Bar
        const progressPercent = ((currentQIndex) / questions.length) * 100;
        document.getElementById('progress-bar').style.width = `${progressPercent}%`;
        
        document.getElementById('q-progress').innerText = `Q ${currentQIndex + 1} / ${questions.length}`;
        document.getElementById('live-score').innerText = score;
        document.getElementById('q-text').innerText = q.q;
        document.getElementById('next-btn').classList.add('hidden');

        const container = document.getElementById('options-container');
        container.innerHTML = "";

        q.options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = opt;
            btn.onclick = () => checkAnswer(btn, opt, q.correct);
            container.appendChild(btn);
        });
    }

    function checkAnswer(btn, selected, correct) {
        const allBtns = document.querySelectorAll('.option-btn');
        allBtns.forEach(b => b.disabled = true);

        if(selected === correct) {
            btn.classList.add('correct');
            score++;
        } else {
            btn.classList.add('wrong');
            allBtns.forEach(b => {
                if(b.innerText === correct) b.classList.add('correct');
            });
        }
        document.getElementById('next-btn').classList.remove('hidden');
    }

    function nextQuestion() {
        currentQIndex++;
        if(currentQIndex < questions.length) {
            loadQuestion();
        } else {
            submitScore();
        }
    }

    // 4. SUBMIT & CONFETTI
    function submitScore() {
        switchScreen('screen-loading');
        document.querySelector('#screen-loading h1').innerText = "Finalizing...";
        document.querySelector('#screen-loading p').innerText = "Saving your victory.";

        const payload = {
            name: userDetails.name,
            phone: userDetails.phone,
            chapter: userDetails.chapter,
            score: score
        };

        fetch(GOOGLE_SCRIPT_URL, {
            method: 'POST', mode: 'no-cors',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        }).then(() => {
            showResult();
        }).catch(err => {
            showResult(); // Show result even if network fails
        });
    }

    function showResult() {
        document.getElementById('final-score').innerText = score;
        switchScreen('screen-result');
        // Trigger Confetti
        confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
    }

    function switchScreen(id) {
        document.querySelectorAll('.app-container > div').forEach(div => div.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
    }

</script>

</body>
</html>
