<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MS Word Quiz Portal</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Word Blue Theme */
            --primary: #2b579a; 
            --accent: #487fd9;
            --glass: rgba(255, 255, 255, 0.95);
            --text: #2d3436;
            --success: #6ab04c;
            --error: #eb4d4b;
        }

        body {
            margin: 0; font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            min-height: 100vh; display: flex; align-items: center; justify-content: center;
            padding: 20px;
        }

        .app-container {
            width: 100%; max-width: 600px;
            background: var(--glass);
            border-radius: 24px; padding: 40px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            text-align: center; position: relative;
            overflow: hidden;
        }

        h1 { margin: 0 0 10px; color: var(--primary); font-weight: 800; text-transform: uppercase; }
        p { color: #636e72; font-size: 14px; margin-bottom: 30px; }

        input, select {
            width: 100%; padding: 15px; margin-bottom: 15px;
            border: 2px solid #dfe6e9; border-radius: 12px;
            font-family: inherit; font-weight: 600; box-sizing: border-box;
            outline: none; transition: 0.3s;
        }
        input:focus, select:focus { border-color: var(--primary); }

        .btn {
            width: 100%; padding: 16px; background: var(--primary);
            color: white; border: none; border-radius: 12px;
            font-weight: 800; font-size: 16px; cursor: pointer;
            transition: transform 0.1s; text-transform: uppercase;
        }
        .btn:active { transform: scale(0.98); }
        .btn:disabled { background: #b2bec3; cursor: not-allowed; }

        .hidden { display: none; }

        /* Quiz Styles */
        .option-btn {
            background: white; border: 2px solid #dfe6e9; color: var(--text);
            padding: 15px; margin-bottom: 10px; width: 100%; text-align: left;
            border-radius: 12px; cursor: pointer; font-weight: 600; transition: 0.2s;
        }
        .option-btn:hover { border-color: var(--primary); background: #f1f2f6; }
        .correct { background: #badc58 !important; border-color: var(--success) !important; color: #136a23; }
        .wrong { background: #ffbe76 !important; border-color: var(--error) !important; color: #c23616; }

        /* Loading */
        .loader {
            width: 50px; height: 50px; border: 5px solid #dfe6e9;
            border-top: 5px solid var(--primary); border-radius: 50%;
            animation: spin 1s linear infinite; margin: 20px auto;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* Topic Grid */
        .chapter-grid {
            display: grid; grid-template-columns: 1fr; gap: 10px;
            text-align: left; margin-bottom: 20px;
            max-height: 300px; overflow-y: auto;
            padding-right: 5px;
        }
        @media (min-width: 500px) {
            .chapter-grid { grid-template-columns: 1fr 1fr; }
        }

        .chapter-btn {
            background: white; border: 2px solid #dfe6e9; padding: 15px;
            border-radius: 12px; font-size: 13px; font-weight: 700; cursor: pointer;
            display: flex; align-items: center; justify-content: space-between;
        }
        .chapter-btn:hover { border-color: var(--primary); }
        .chapter-btn.selected { background: var(--primary); color: white; border-color: var(--primary); }

    </style>
</head>
<body>

    <div class="app-container">
        
        <div id="screen-login">
            <h1 style="font-size: 28px;">MS Word Quiz üìù</h1>
            <p>Enter your details to start the practice session.</p>
            <input type="text" id="inp-name" placeholder="Full Name">
            <input type="tel" id="inp-phone" placeholder="Phone Number" maxlength="10">
            <button class="btn" onclick="goToChapters()">Next ‚ûù</button>
        </div>

        <div id="screen-chapters" class="hidden">
            <h1>Select Topic</h1>
            <p>Choose a topic to generate a quiz.</p>
            <div class="chapter-grid" id="chapter-list"></div>
            <button class="btn" id="start-quiz-btn" onclick="startQuiz()" disabled>Start AI Quiz ‚ö°</button>
        </div>

        <div id="screen-loading" class="hidden">
            <h1>Generating...</h1>
            <div class="loader"></div>
            <p>AI is creating 20 unique questions about <br><b id="loading-topic">Topic</b>.</p>
        </div>

        <div id="screen-quiz" class="hidden">
            <div style="display:flex; justify-content:space-between; font-size:12px; font-weight:800; margin-bottom:10px; color:#b2bec3;">
                <span id="q-progress">1 / 20</span>
                <span>Score: <span id="live-score">0</span></span>
            </div>
            <h2 id="q-text" style="font-size:18px; margin-bottom:20px;">Question text...</h2>
            <div id="options-container"></div>
            <button id="next-btn" class="btn hidden" style="margin-top:20px;" onclick="nextQuestion()">Next Question ‚ûù</button>
        </div>

        <div id="screen-result" class="hidden">
            <h1>Quiz Complete!</h1>
            <div style="font-size:60px; margin:20px 0;">üíæ</div>
            <p>Your score has been saved to the database.</p>
            <h2 style="font-size:40px; color:var(--primary); margin:0;"><span id="final-score">0</span>/20</h2>
            <p style="margin-top:5px;">Total Marks</p>
            <button class="btn" onclick="location.reload()">Take Another Quiz</button>
        </div>

    </div>

<script>
    // ---------------- CONFIGURATION ---------------- //
    
    // ‚úÖ YOUR GOOGLE SCRIPT URL
    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyGk79tReDKSBGzXK572mQhKhkS84rL0HGj6ioBk_m6mb8G7vfS1Lc_OGPVgckQ-q-eyg/exec"; 

    // ‚úÖ YOUR API KEY
    const API_KEY = "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"; 

    // MS WORD TOPICS
    const chapters = [
        "1. Introduction to Word Processing",
        "2. MS Word Interface",
        "3. File Menu Operations",
        "4. Edit Menu Operations",
        "5. Viewing Documents",
        "6. Insert Menu Features",
        "7. Formatting Features",
        "8. Tools Menu",
        "9. Tables in MS Word",
        "10. Keyboard Shortcuts",
        "11. Help Menu"
    ];

    // ---------------- VARIABLES ---------------- //
    let userDetails = { name: "", phone: "", chapter: "" };
    let questions = [];
    let currentQIndex = 0;
    let score = 0;

    // ---------------- LOGIC ---------------- //

    // 1. LOGIN
    function goToChapters() {
        const name = document.getElementById('inp-name').value;
        const phone = document.getElementById('inp-phone').value;

        if(!name || phone.length < 10) return alert("Please enter valid Name and Phone!");
        
        userDetails.name = name;
        userDetails.phone = phone;

        // Render Chapters
        const grid = document.getElementById('chapter-list');
        grid.innerHTML = "";
        chapters.forEach(chap => {
            const btn = document.createElement('div');
            btn.className = 'chapter-btn';
            btn.innerText = chap;
            btn.onclick = () => selectChapter(btn, chap);
            grid.appendChild(btn);
        });

        switchScreen('screen-chapters');
    }

    function selectChapter(btn, chapName) {
        document.querySelectorAll('.chapter-btn').forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
        userDetails.chapter = chapName;
        document.getElementById('start-quiz-btn').disabled = false;
    }

    // 2. GENERATE QUIZ
    async function startQuiz() {
        switchScreen('screen-loading');
        document.getElementById('loading-topic').innerText = userDetails.chapter;

        const systemPrompt = `You are an IT Teacher specializing in Microsoft Word. 
        Create exactly 20 Multiple Choice Questions (MCQs) on the topic: "${userDetails.chapter}".
        
        Format: JSON Array of objects. 
        Each object must have: { "q": "Question text", "options": ["A", "B", "C", "D"], "correct": "Correct Option Text" }
        
        IMPORTANT:
        - Questions must be specific to MS Word (2016/2019 versions).
        - If topic is 'Keyboard Shortcuts', focus on Ctrl+ keys.
        - Do NOT add markdown blocks. Output raw JSON only.`;

        try {
            const response = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                method: "POST",
                headers: { "Authorization": `Bearer ${API_KEY}`, "Content-Type": "application/json" },
                body: JSON.stringify({
                    model: "llama-3.3-70b-versatile",
                    messages: [{ role: "user", content: systemPrompt }],
                    temperature: 0.5
                })
            });

            const data = await response.json();
            let rawContent = data.choices[0].message.content;
            rawContent = rawContent.replace(/```json/g, "").replace(/```/g, "").trim();
            
            questions = JSON.parse(rawContent);
            
            if(questions.length > 0) {
                currentQIndex = 0; score = 0;
                loadQuestion();
                switchScreen('screen-quiz');
            } else {
                throw new Error("Empty question list");
            }

        } catch (error) {
            console.error(error);
            alert("AI Error. Please try again or check API Key.");
            location.reload();
        }
    }

    // 3. RUN QUIZ
    function loadQuestion() {
        const q = questions[currentQIndex];
        document.getElementById('q-progress').innerText = `${currentQIndex + 1} / ${questions.length}`;
        document.getElementById('live-score').innerText = score;
        document.getElementById('q-text').innerText = q.q;
        document.getElementById('next-btn').classList.add('hidden');

        const container = document.getElementById('options-container');
        container.innerHTML = "";

        q.options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = opt;
            btn.onclick = () => checkAnswer(btn, opt, q.correct);
            container.appendChild(btn);
        });
    }

    function checkAnswer(btn, selected, correct) {
        const allBtns = document.querySelectorAll('.option-btn');
        allBtns.forEach(b => b.disabled = true);

        if(selected === correct) {
            btn.classList.add('correct');
            score++;
        } else {
            btn.classList.add('wrong');
            allBtns.forEach(b => {
                if(b.innerText === correct) b.classList.add('correct');
            });
        }
        document.getElementById('next-btn').classList.remove('hidden');
    }

    function nextQuestion() {
        currentQIndex++;
        if(currentQIndex < questions.length) {
            loadQuestion();
        } else {
            submitScore();
        }
    }

    // 4. SUBMIT TO GOOGLE SHEET
    function submitScore() {
        switchScreen('screen-loading');
        document.querySelector('#screen-loading h1').innerText = "Submitting Score...";
        document.querySelector('#screen-loading p').innerText = "Sending data to Google Sheets...";

        const payload = {
            name: userDetails.name,
            phone: userDetails.phone,
            chapter: userDetails.chapter,
            score: score
        };

        fetch(GOOGLE_SCRIPT_URL, {
            method: 'POST',
            mode: 'no-cors',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        }).then(() => {
            document.getElementById('final-score').innerText = score;
            switchScreen('screen-result');
        }).catch(err => {
            alert("Score saved locally (Network Error).");
            document.getElementById('final-score').innerText = score;
            switchScreen('screen-result');
        });
    }

    // UTILS
    function switchScreen(id) {
        document.querySelectorAll('.app-container > div').forEach(div => div.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
    }

</script>

</body>
</html>