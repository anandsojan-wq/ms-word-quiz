<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MS Word Quiz</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        :root {
            --bg-dark: #050505;
            --primary: #00f2ea;
            --secondary: #ff0050;
            --accent: #7d2ae8;
            --glass: rgba(20, 20, 30, 0.7);
            --glass-border: rgba(255, 255, 255, 0.1);
            --text: #ffffff;
            --text-muted: #8b9bb4;
        }

        body {
            margin: 0;
            font-family: 'Outfit', sans-serif;
            background-color: var(--bg-dark);
            background-image: 
                radial-gradient(at 0% 0%, rgba(125, 42, 232, 0.3) 0px, transparent 50%),
                radial-gradient(at 100% 0%, rgba(0, 242, 234, 0.3) 0px, transparent 50%),
                radial-gradient(at 100% 100%, rgba(255, 0, 80, 0.3) 0px, transparent 50%);
            background-size: 150% 150%;
            animation: gradientMove 15s ease infinite;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: var(--text);
            overflow-x: hidden;
        }

        @keyframes gradientMove {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* --- CONTAINER --- */
        .app-container {
            width: 100%; max-width: 550px;
            background: var(--glass);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border: 1px solid var(--glass-border);
            border-radius: 30px;
            padding: 40px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            text-align: center;
            position: relative;
            overflow: hidden;
            transition: height 0.3s ease;
            z-index: 10;
        }

        /* --- LOGO STYLING --- */
        .login-logo {
            width: 440px; 
            max-width: 100%; 
            margin-bottom: 25px;
            filter: drop-shadow(0 0 15px rgba(0, 242, 234, 0.4));
            transition: transform 0.5s;
        }
        .login-logo:hover { transform: scale(1.02) rotate(1deg); }

        h1 {
            font-weight: 800; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px;
            background: linear-gradient(to right, #fff, #a5a5a5);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        p { color: var(--text-muted); font-size: 14px; margin-bottom: 30px; font-weight: 500; }

        /* --- INPUTS --- */
        input {
            width: 100%; padding: 16px; margin-bottom: 15px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid var(--glass-border);
            border-radius: 16px;
            color: white; font-family: inherit; font-weight: 600;
            box-sizing: border-box; outline: none;
            transition: 0.3s;
            font-size: 16px !important;
        }
        input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 20px rgba(0, 242, 234, 0.2);
            background: rgba(0, 0, 0, 0.5);
        }

        /* --- NEON BUTTONS --- */
        .btn {
            width: 100%; padding: 18px;
            background: linear-gradient(90deg, var(--accent), var(--secondary));
            border: none; border-radius: 16px;
            color: white; font-weight: 800; font-size: 16px;
            text-transform: uppercase; letter-spacing: 1px;
            cursor: pointer; position: relative; overflow: hidden;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            box-shadow: 0 10px 30px rgba(125, 42, 232, 0.3);
            margin-bottom: 10px;
        }
        .btn:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 15px 40px rgba(125, 42, 232, 0.5);
        }
        .btn:active { transform: scale(0.98); }
        .btn:disabled { filter: grayscale(1); opacity: 0.6; cursor: not-allowed; transform: none; }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--glass-border);
            box-shadow: none;
        }
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.2);
        }

        /* --- TIMER --- */
        .timer-badge {
            background: rgba(255, 0, 80, 0.2);
            border: 1px solid var(--secondary);
            color: var(--secondary);
            padding: 8px 16px; border-radius: 20px;
            font-weight: 800; font-size: 14px;
            display: inline-block; margin-bottom: 15px;
            box-shadow: 0 0 10px rgba(255, 0, 80, 0.4);
        }

        /* --- PROGRESS BAR --- */
        .progress-track {
            width: 100%; height: 6px; background: rgba(255,255,255,0.1);
            border-radius: 10px; margin-bottom: 25px; overflow: hidden;
        }
        .progress-fill {
            height: 100%; width: 0%; background: var(--primary);
            border-radius: 10px; transition: width 0.5s ease;
            box-shadow: 0 0 10px var(--primary);
        }

        /* --- TOPIC CARDS --- */
        .chapter-grid {
            display: grid; grid-template-columns: 1fr; gap: 12px;
            max-height: 350px; overflow-y: auto; padding: 5px;
        }
        .chapter-grid::-webkit-scrollbar { width: 6px; }
        .chapter-grid::-webkit-scrollbar-thumb { background: var(--glass-border); border-radius: 10px; }

        @media(min-width: 500px) { .chapter-grid { grid-template-columns: 1fr 1fr; } }

        .chapter-btn {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--glass-border);
            padding: 15px; border-radius: 16px;
            font-size: 13px; font-weight: 700; text-align: left;
            cursor: pointer; transition: all 0.3s;
            display: flex; align-items: center; justify-content: space-between;
        }
        .chapter-btn:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: var(--primary);
            transform: translateX(5px);
        }
        .chapter-btn.selected {
            background: linear-gradient(45deg, var(--primary), #00a8a3);
            border-color: transparent;
            color: #000;
            box-shadow: 0 5px 20px rgba(0, 242, 234, 0.3);
        }

        /* --- QUIZ OPTIONS --- */
        .option-btn {
            width: 100%; padding: 16px; margin-bottom: 12px;
            background: rgba(255,255,255,0.03);
            border: 1px solid var(--glass-border);
            border-radius: 16px; color: var(--text);
            text-align: left; font-weight: 600; cursor: pointer;
            transition: all 0.2s; font-size: 15px;
        }
        .option-btn:hover {
            background: rgba(255,255,255,0.1);
            border-color: var(--primary);
        }
        .correct {
            background: rgba(46, 213, 115, 0.2) !important;
            border-color: #2ed573 !important; color: #2ed573;
        }
        .wrong {
            background: rgba(255, 71, 87, 0.2) !important;
            border-color: #ff4757 !important; color: #ff4757;
        }

        /* --- LOADER --- */
        .loader {
            width: 50px; height: 50px;
            border: 4px solid rgba(255,255,255,0.1);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        .hidden { display: none; }

        /* --- FOOTER --- */
        .dev-footer {
            position: fixed;
            bottom: 15px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.4);
            letter-spacing: 1px;
            font-weight: 600;
            text-transform: uppercase;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            z-index: 5;
        }
        
        .logout-link {
            font-size: 12px; color: var(--text-muted); text-decoration: underline; cursor: pointer; margin-top: 15px; display: inline-block;
        }
    </style>
</head>
<body>

    <div class="app-container">
        
        <div id="screen-login">
            <img src="logo.png" alt="Logo" class="login-logo">
            <h1>MS Word Quiz Portal</h1>
            
            <div id="login-form">
                <p>Access the portal to begin your assessment.</p>
                <input type="text" id="inp-name" placeholder="Full Name">
                <input type="tel" id="inp-phone" placeholder="Phone Number" maxlength="10">
                <button class="btn" onclick="loginAndStart()">Enter Portal ‚ûù</button>
            </div>

            <div id="welcome-back" class="hidden">
                <p style="font-size: 18px; color: white;">Hello, <b style="color:var(--primary)" id="user-name-display">Student</b>!</p>
                <button class="btn" onclick="startSession()">Begin Quiz ‚ûù</button>
                <span class="logout-link" onclick="logout()">Not you? Logout</span>
            </div>
        </div>

        <div id="screen-chapters" class="hidden">
            <h1>Select Module</h1>
            <p>Choose a topic.</p>
            <div class="chapter-grid" id="chapter-list"></div>
            <button class="btn" id="start-quiz-btn" style="margin-top:20px;" onclick="startQuiz()" disabled>Begin Quiz ‚ö°</button>
        </div>

        <div id="screen-loading" class="hidden">
            <h1 class="pulse">Processing...</h1>
            <div class="loader"></div>
            <p>Questions are being generated<br><b style="color:var(--primary)" id="loading-topic">...</b></p>
        </div>

        <div id="screen-quiz" class="hidden">
            
            <div class="timer-badge">‚è±Ô∏è Time Left: <span id="timer-display">05:00</span></div>

            <div class="progress-track"><div class="progress-fill" id="progress-bar"></div></div>

            <div style="display:flex; justify-content:space-between; font-size:14px; color:var(--text-muted); margin-bottom:15px; font-weight:700;">
                <span id="q-progress">Q 1</span>
                <span>Score: <span style="color:var(--primary)" id="live-score">0</span></span>
            </div>

            <h2 id="q-text" style="font-size:20px; font-weight:700; margin-bottom:25px; min-height:60px;">Loading Question...</h2>
            
            <div id="options-container"></div>
            
            <button id="next-btn" class="btn hidden" style="margin-top:20px; background: var(--primary);" onclick="nextQuestion()">Next Question ‚ûù</button>
        </div>

        <div id="screen-result" class="hidden">
            <h1>Assessment Complete</h1>
            <div style="font-size:80px; margin:20px 0; text-shadow: 0 0 30px var(--primary);">üèÜ</div>
            <p>Score successfully uploaded to database.</p>
            
            <div style="background:rgba(255,255,255,0.05); padding:20px; border-radius:20px; margin-bottom:20px; border:1px solid var(--glass-border);">
                <span style="font-size:14px; color:var(--text-muted); text-transform:uppercase; letter-spacing:1px;">Final Score</span>
                <h2 style="font-size:56px; color:var(--primary); margin:0; line-height:1;"><span id="final-score">0</span><span style="font-size:20px; color:var(--text-muted)">/20</span></h2>
            </div>

            <button class="btn btn-secondary" onclick="generatePDF()">üìÑ Download Report</button>
            
            <button class="btn" onclick="returnToChapters()">Return to Topics</button>
        </div>

    </div>

    <div class="dev-footer">Developed by ICM Educations</div>

<script>
    // ---------------- CONFIGURATION ---------------- //
    
    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyGk79tReDKSBGzXK572mQhKhkS84rL0HGj6ioBk_m6mb8G7vfS1Lc_OGPVgckQ-q-eyg/exec"; 
    const API_KEY = "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"; 

    const chapters = [
        "1. Introduction to Word Processing",
        "2. MS Word Interface",
        "3. File Menu Operations",
        "4. Edit Menu Operations",
        "5. Viewing Documents",
        "6. Insert Menu Features",
        "7. Formatting Features",
        "8. Tools Menu",
        "9. Tables in MS Word",
        "10. Keyboard Shortcuts",
        "11. Help Menu"
    ];

    // ---------------- VARIABLES ---------------- //
    let userDetails = { name: "", phone: "", chapter: "" };
    let questions = [];
    let currentQIndex = 0;
    let score = 0;
    let userAnswers = []; 
    let timerInterval = null;
    let timeRemaining = 300; // 5 Minutes

    // ---------------- LOGIC ---------------- //

    // 1. INITIAL LOAD & CHECK LOGIN
    window.onload = function() {
        const savedData = localStorage.getItem('ms_word_quiz_user');
        if (savedData) {
            userDetails = JSON.parse(savedData);
            document.getElementById('login-form').classList.add('hidden');
            document.getElementById('welcome-back').classList.remove('hidden');
            document.getElementById('user-name-display').innerText = userDetails.name;
        }
    };

    function startSession() {
        renderChapters();
        switchScreen('screen-chapters');
    }

    function logout() {
        if(confirm("Are you sure you want to logout?")) {
            localStorage.removeItem('ms_word_quiz_user');
            location.reload();
        }
    }

    function loginAndStart() {
        const name = document.getElementById('inp-name').value;
        const phone = document.getElementById('inp-phone').value;

        if(!name || phone.length < 10) return alert("Please enter valid Name and Phone!");
        
        userDetails.name = name;
        userDetails.phone = phone;

        // Save to Local Storage
        localStorage.setItem('ms_word_quiz_user', JSON.stringify({name: name, phone: phone}));

        startSession();
    }

    function renderChapters() {
        const grid = document.getElementById('chapter-list');
        grid.innerHTML = "";
        chapters.forEach(chap => {
            const btn = document.createElement('div');
            btn.className = 'chapter-btn';
            btn.innerHTML = `${chap} <span>‚ûú</span>`;
            btn.onclick = () => selectChapter(btn, chap);
            grid.appendChild(btn);
        });
    }

    function selectChapter(btn, chapName) {
        document.querySelectorAll('.chapter-btn').forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
        userDetails.chapter = chapName;
        document.getElementById('start-quiz-btn').disabled = false;
    }

    // 2. GENERATE QUIZ
    async function startQuiz() {
        switchScreen('screen-loading');
        document.getElementById('loading-topic').innerText = userDetails.chapter;
        
        // Reset Variables
        score = 0;
        currentQIndex = 0;
        userAnswers = []; 
        timeRemaining = 300; // Reset Timer to 5 mins

        const systemPrompt = `You are an IT Teacher specializing in Microsoft Word. 
        Create exactly 20 Multiple Choice Questions (MCQs) on the topic: "${userDetails.chapter}".
        
        Format: JSON Array of objects. 
        Each object: { "q": "Question text", "options": ["A", "B", "C", "D"], "correct": "Correct Option Text" }
        
        IMPORTANT:
        - Questions must be specific to MS Word (2016/2019 versions).
        - If topic is 'Keyboard Shortcuts', focus on Ctrl+ keys.
        - JSON ONLY. No markdown.`;

        try {
            const response = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                method: "POST",
                headers: { "Authorization": `Bearer ${API_KEY}`, "Content-Type": "application/json" },
                body: JSON.stringify({
                    model: "llama-3.3-70b-versatile",
                    messages: [{ role: "user", content: systemPrompt }],
                    temperature: 0.5
                })
            });

            const data = await response.json();
            let rawContent = data.choices[0].message.content;
            rawContent = rawContent.replace(/```json/g, "").replace(/```/g, "").trim();
            questions = JSON.parse(rawContent);
            
            if(questions.length > 0) {
                loadQuestion();
                startTimer(); // Start the clock!
                switchScreen('screen-quiz');
            } else { throw new Error("Empty list"); }

        } catch (error) {
            console.error(error);
            alert("AI Error. Please check API Key.");
            location.reload();
        }
    }

    // 3. TIMER LOGIC
    function startTimer() {
        clearInterval(timerInterval); // Clear any old timers
        updateTimerDisplay();
        
        timerInterval = setInterval(() => {
            timeRemaining--;
            updateTimerDisplay();
            
            if(timeRemaining <= 0) {
                clearInterval(timerInterval);
                alert("‚è∞ Time's Up! Submitting your quiz.");
                submitScore(); // Auto-submit
            }
        }, 1000);
    }

    function updateTimerDisplay() {
        const minutes = Math.floor(timeRemaining / 60);
        const seconds = timeRemaining % 60;
        document.getElementById('timer-display').innerText = 
            `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }

    // 4. RUN QUIZ
    function loadQuestion() {
        const q = questions[currentQIndex];
        
        const progressPercent = ((currentQIndex) / questions.length) * 100;
        document.getElementById('progress-bar').style.width = `${progressPercent}%`;
        
        document.getElementById('q-progress').innerText = `Q ${currentQIndex + 1} / ${questions.length}`;
        document.getElementById('live-score').innerText = score;
        document.getElementById('q-text').innerText = q.q;
        document.getElementById('next-btn').classList.add('hidden');

        const container = document.getElementById('options-container');
        container.innerHTML = "";

        q.options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = opt;
            btn.onclick = () => checkAnswer(btn, opt, q.correct);
            container.appendChild(btn);
        });
    }

    function checkAnswer(btn, selected, correct) {
        const allBtns = document.querySelectorAll('.option-btn');
        allBtns.forEach(b => b.disabled = true);

        // Record Answer for PDF
        const currentQ = questions[currentQIndex];
        userAnswers.push({
            question: currentQ.q,
            selected: selected,
            correct: correct,
            isCorrect: (selected === correct)
        });

        if(selected === correct) {
            btn.classList.add('correct');
            score++;
        } else {
            btn.classList.add('wrong');
            allBtns.forEach(b => {
                if(b.innerText === correct) b.classList.add('correct');
            });
        }
        document.getElementById('next-btn').classList.remove('hidden');
    }

    function nextQuestion() {
        currentQIndex++;
        if(currentQIndex < questions.length) {
            loadQuestion();
        } else {
            submitScore();
        }
    }

    // 5. SUBMIT & CONFETTI
    function submitScore() {
        clearInterval(timerInterval); // Stop the clock
        switchScreen('screen-loading');
        document.querySelector('#screen-loading h1').innerText = "Finalizing...";
        document.querySelector('#screen-loading p').innerText = "Saving your progress.";

        const payload = {
            name: userDetails.name,
            phone: userDetails.phone,
            chapter: userDetails.chapter,
            score: score
        };

        fetch(GOOGLE_SCRIPT_URL, {
            method: 'POST', mode: 'no-cors',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        }).then(() => {
            showResult();
        }).catch(err => {
            showResult(); 
        });
    }

    function showResult() {
        document.getElementById('final-score').innerText = score;
        switchScreen('screen-result');
        confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
    }

    // 6. PDF GENERATION
    function generatePDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        const primaryColor = [0, 150, 150]; 
        const correctColor = [0, 128, 0];   
        const wrongColor = [200, 0, 0];     

        doc.setFontSize(22);
        doc.setTextColor(...primaryColor);
        doc.text("MS Word Quiz Report", 105, 20, null, null, "center");
        
        doc.setFontSize(12);
        doc.setTextColor(50, 50, 50);
        doc.text(`Student Name: ${userDetails.name}`, 20, 35);
        doc.text(`Topic: ${userDetails.chapter}`, 20, 42);
        doc.text(`Date: ${new Date().toLocaleDateString()}`, 20, 49);
        
        doc.setFontSize(16);
        doc.setTextColor(...primaryColor);
        doc.text(`Final Score: ${score} / 20`, 150, 42);

        doc.line(20, 55, 190, 55); 

        let y = 65; 

        userAnswers.forEach((item, index) => {
            if (y > 270) { 
                doc.addPage();
                y = 20;
            }

            doc.setFontSize(11);
            doc.setTextColor(0, 0, 0);
            doc.setFont("helvetica", "bold");
            const qLines = doc.splitTextToSize(`Q${index + 1}. ${item.question}`, 170);
            doc.text(qLines, 20, y);
            y += (qLines.length * 6);

            doc.setFontSize(10);
            doc.setFont("helvetica", "normal");
            
            if(item.isCorrect) {
                doc.setTextColor(...correctColor);
                doc.text(`Your Answer: ${item.selected} (Correct)`, 20, y);
            } else {
                doc.setTextColor(...wrongColor);
                doc.text(`Your Answer: ${item.selected} (Wrong)`, 20, y);
                y += 5;
                doc.setTextColor(...correctColor);
                doc.text(`Correct Answer: ${item.correct}`, 20, y);
            }
            
            y += 10; 
        });

        doc.save(`${userDetails.name}_Quiz_Report.pdf`);
    }

    // 7. NAVIGATION (FIXED)
    function returnToChapters() {
        switchScreen('screen-chapters');
        document.getElementById('start-quiz-btn').disabled = true;
        document.querySelectorAll('.chapter-btn').forEach(b => b.classList.remove('selected'));
    }

    function switchScreen(id) {
        document.querySelectorAll('.app-container > div').forEach(div => div.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
    }

</script>

</body>
</html>
